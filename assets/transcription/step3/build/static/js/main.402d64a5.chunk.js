(this["webpackJsonpindaba-transcription"]=this["webpackJsonpindaba-transcription"]||[]).push([[0],{122:function(e,t,n){e.exports=n(179)},127:function(e,t,n){},128:function(e,t,n){},179:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(13),o=n.n(r),l=(n(127),n(128),n(101)),c=n(45),s=n(29),d=n(102),u=n(103),p=n(112),m=n(104),h=n.n(m),f=n(220),g=n(215),v=n(216),E=n(217),b=n(223),y=n(219),k=n(218),C=n(109),w=n.n(C),x=n(110),O=n.n(x),S=n(59),T=n.n(S),N=n(2),B=n(5),I=n(222),j=n(212),z=n(213),R=n(107),V=n.n(R),P=n(180),D=n(41),H=Object(B.a)((function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}))((function(e){var t=e.children,n=e.classes,a=e.onClose,r=Object(N.a)(e,["children","classes","onClose"]);return i.a.createElement(j.a,Object.assign({disableTypography:!0,className:n.root},r),i.a.createElement(P.a,{variant:"h6"},t),a?i.a.createElement(y.a,{"aria-label":"close",className:n.closeButton,onClick:a},i.a.createElement(V.a,null)):null)})),W=Object(B.a)((function(e){return{root:{padding:e.spacing(2)}}}))(z.a);function A(e){var t=e.videoClip,n=e.open,a=null;if(t.starttime&&t.endtime){var r=J(t.starttime),o=J(t.endtime);setInterval((function(){if(null!==a){a.play();var e=a.getState().player.currentTime;(e<=r||e>=o)&&a.seek(r)}}),200)}return i.a.createElement("div",null,i.a.createElement(I.a,{onClose:e.onClose,"aria-labelledby":"customized-dialog-title",open:n},i.a.createElement(H,{id:"customized-dialog-title",onClose:e.onClose},"Video Segment "+t.index+"/"+t.size),i.a.createElement(W,{dividers:!0,style:{width:"600px",height:"400px"}},i.a.createElement(D.Player,{ref:function(e){a=e}},i.a.createElement("source",{src:e.src}),i.a.createElement(D.BigPlayButton,{position:"center"}),i.a.createElement(D.Shortcut,{clickable:!0}),i.a.createElement(D.ControlBar,{autoHide:!1})))))}function J(e){if(!isNaN(e))return e;var t=e.match(/^(?:(\d{2,}):)?(\d{2}):(\d{2})[,.](\d{3})$/);if(!t)throw new Error('Invalid SRT or VTT time format: "'+e+'"');return((t[1]?36e5*parseInt(t[1],10):0)+6e4*parseInt(t[2],10)+1e3*parseInt(t[3],10)+parseInt(t[4],10))/1e3}var U=function(e){function t(e,n){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e,n))).handleVideoPlay=function(e){var t=e.starttime,n=e.endtime,i=a.state.original,r=i.transcription.chunks.findIndex((function(e){return e.starttime===t}));a.setState({videoOpen:!0,videoClip:{index:++r,size:i.transcription.chunks.length,starttime:t,endtime:n}})},a.handleConfirm=function(e,t){var n=a.state.original,i=n.transcription.chunks.findIndex((function(e){return e.starttime===t.starttime})),r=n.transcription.chunks[i].contributions,o=r.findIndex((function(e){return!0===e.annotations.selected})),c=e.target.parentNode.parentNode.parentNode.parentNode.parentNode;"row"!==c.className&&(c=c.parentNode);var s=c.children[0].children[o];if(!s)return console.log("Pick a contribution first..."),a.setState({open:!0,currentTarget:e.currentTarget});n.transcription.chunks[i].doneReview=!0;var d=s.getElementsByTagName("input")[0].value,u=Object(l.a)({},r[o]);u.text=d,u.reviewedBy=a.props.reviewer,u.reviewedAt=(new Date).toLocaleString("en-US"),n.transcription.chunks[i].adoptedContribution=u,console.log(n.transcription),a.setState({original:n}),a.saveEdit()},a.handleTextClick=function(e,t){var n=a.state.original,i=n.transcription.chunks.findIndex((function(t){return t.starttime===e.starttime}));n.transcription.chunks[i].attempted=!0;var r=n.transcription.chunks[i].contributions,o=r.indexOf(t);r.forEach((function(e){e.annotations.selected=!1})),r[o].annotations.selected=!0,n.transcription.chunks[i].contributions=r,a.setState({original:n})},a.handleClose=function(){a.setState({open:!1})},a.handleVideoClose=function(){a.setState({videoOpen:!1})},a.generateCardColor=function(e){return e.doneReview?"success":"core"},a.generateCardTextColor=function(e){return e.doneReview?"white":"black"},a.display=function(e,t){return t?e.attempted?t.annotations.selected?"block":"none":"block":e.attempted?e.doneReview?"#52a451":"white":"black"},a.displayCard=function(e){return e.doneReview?"none":"block"},a.generateDisable=function(e){return e.annotations.selected?{}:(e.annotations.selected=!1,{disabled:"disabled"})},a.formatCardHeader=function(e){var t=a.state.original,n=t.transcription.chunks.findIndex((function(t){return t.starttime===e.starttime}));return++n+"/"+t.transcription.chunks.length+"\xa0\xa0\xa0\xa0\xa0\xa0"+e.starttime.split(",")[0]+" ~ "+e.endtime.split(",")[0]},a.state={original:{transcription:{chunks:[]}},open:!1,videoOpen:!1,currentTarget:null,videoClip:{}},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.serverRequest=T.a.get("/api/watch/edit/"+this.props.id).then(function(e){e.data.transcription||(e.data.transcription={chunks:[]}),e.data.transcription.chunks.forEach((function(e){e.contributions||(e.contributions=[]),e.contributions.forEach((function(e){e.annotations||(e.annotations=[])}))})),this.setState({original:e.data})}.bind(this))}},{key:"saveEdit",value:function(){T.a.post("/api/watch/savedit/"+this.props.id+"?apikey="+this.props.apikey,this.state.original).then((function(e){console.log(e)}))}},{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement("h1",null,"Video Transcription Review"),i.a.createElement("br",null),i.a.createElement("div",{style:{width:"100%",height:"90vh"}},i.a.createElement(h.a,null,this.state.original.transcription.chunks.map((function(t){return i.a.createElement("div",null,i.a.createElement(f.a,{bg:e.generateCardColor(t),text:e.generateCardTextColor(t),style:{width:"95%"}},i.a.createElement(f.a.Header,{style:{fontWeight:"bold"}},e.formatCardHeader(t)),i.a.createElement(f.a.Body,null,i.a.createElement(g.a,null,i.a.createElement(v.a,null,i.a.createElement(E.a,null,t.contributions.map((function(n){return i.a.createElement("div",null,i.a.createElement(v.a,null,i.a.createElement(E.a,{xs:2,style:{fontWeight:"bold",color:e.display(t)}},n.user.toUpperCase()),i.a.createElement(E.a,null,i.a.createElement("div",{style:{display:e.display(t,n)}},i.a.createElement(k.a,Object.assign({},e.generateDisable(n),{defaultValue:n.text,style:{width:"95%"},onClick:function(){return e.handleTextClick(t,n)}}))))),i.a.createElement("br",null))}))),i.a.createElement(E.a,{xs:2},i.a.createElement("div",{className:"text-center"},i.a.createElement(y.a,{"aria-label":"doneButton"},i.a.createElement(w.a,{style:{fontSize:40,color:"green"},onClick:function(n){return e.handleConfirm(n,t)}})),i.a.createElement("h6",{style:{textAlign:"center"}},"Done"),i.a.createElement(y.a,{"aria-label":"playButton"},i.a.createElement(O.a,{color:"primary",style:{fontSize:40},onClick:function(){return e.handleVideoPlay(t)}})),i.a.createElement("h6",{style:{textAlign:"center"}},"Play Segment"))))))),i.a.createElement("br",null))}))),i.a.createElement(b.a,{id:this.state.open?"simple-popover":void 0,open:this.state.open,anchorEl:this.state.currentTarget,onClose:this.handleClose,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},i.a.createElement("h6",{style:{padding:"1em"}},"Please select a contribution before submission!")),i.a.createElement(A,{open:this.state.videoOpen,src:this.props.src,videoClip:this.state.videoClip,onClose:this.handleVideoClose})))}}]),t}(a.Component),$=n(111),q=n.n($),F=window.location.href.split("/")[5].split("?")[0],L=q.a.parse(window.location.search),M=L.apikey,G=L.name;var K=function(){return i.a.createElement("main",{className:"container mt-3"},i.a.createElement(U,{reviewer:G,src:"/api/watch/getvideo/"+F,id:F,apikey:M}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(177),n(178);o.a.render(i.a.createElement(K,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[122,1,2]]]);
//# sourceMappingURL=main.402d64a5.chunk.js.map